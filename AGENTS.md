# Repository Guidelines

Use this guide when contributing to NewsNow. Keep changes small, focused, and aligned with the existing source-driven architecture.

## Project Structure & Module Organization
- `src/`: React client and routing; `src/routeTree.gen.ts` is generated.
- `server/`: API and data-source fetchers, mainly in `server/sources/`.
- `shared/`: shared types/config; `shared/sources.json` is generated by scripts.
- `public/`: static assets; `screenshots/` holds demo images.
- `scripts/`: build helpers like `scripts/source.ts` and `scripts/favicon.ts`.
- `test/`: Vitest tests.
- `tools/` and `patches/`: utilities and pnpm patches.

## Build, Test, and Development Commands
- `pnpm i`: install dependencies (Node >= 20; run `corepack enable` once).
- `pnpm dev`: regenerate sources then start Vite dev server.
- `pnpm run build`: regenerate sources and build to `dist/output/public`.
- `pnpm start`: run the built server with `.env.server`.
- `pnpm test`: run Vitest.
- `pnpm lint`: run ESLint; `pnpm typecheck` for TypeScript.
- `pnpm presource`: regenerate `shared/sources.json` and related artifacts.

## Coding Style & Naming Conventions
- TypeScript + React; keep existing formatting: 2-space indentation, double quotes, no semicolons.
- Follow `eslint.config.mjs`; lint-staged runs ESLint on commit.
- Naming: `PascalCase` for components, `camelCase` for functions/vars, `kebab-case` for source keys and branch names (e.g., `bilibili-hot-video`).
- Do not edit generated files like `src/routeTree.gen.ts` or `shared/sources.json` directly.

## Testing Guidelines
- Framework: Vitest (`vitest.config.ts`).
- Place tests under `test/` and name them `*.test.ts` (example: `test/common.test.ts`).
- Add tests for new parsing logic or utilities that affect source output.

## Commit & Pull Request Guidelines
- Commits follow conventional style seen in history: `feat: ...`, `fix: ...`, `chore: ...`.
  Example: `feat: Add new source: iqiyi-hot`.
- PRs should explain scope, link relevant issues, and include screenshots for UI changes.
- When adding sources, document the source name, URL, and update cadence.

## Configuration & Secrets
- Copy `example.env.server` to `.env.server` for local runs.
- For Cloudflare, start from `example.wrangler.toml`.
- Never commit secrets or private tokens.
